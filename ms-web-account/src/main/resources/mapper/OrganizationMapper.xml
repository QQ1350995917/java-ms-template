<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pwd.initializr.account.persistence.mapper.OrganizationMapper">
  <!-- create -->
  <insert id="create" keyProperty="id"
    parameterType="pwd.initializr.account.persistence.dao.OrganizationEntity"
    useGeneratedKeys="true">
		insert into `organization`
		(`id`,`pid`,`name`,`logo`,`description`,`slogan`,`level`,`sort`,`members`,`progress`,`status`,`create_time`,`update_time`)
		values
		(#{id},#{pid},#{name},#{logo},#{description},#{slogan},#{level},#{sort},#{members},#{progress},#{status},#{createTime},#{updateTime})
	</insert>

  <!-- update -->
  <update id="update" parameterType="pwd.initializr.account.persistence.mapper.OrganizationMapper">
    update
    `organization`
    <set>
      <if test="name!=null">
        `name` = #{name},
      </if>
      <if test="logo!=null">
        `logo` = #{logo},
      </if>
      <if test="description!=null">
        `description` = #{description},
      </if>
      <if test="slogan!=null">
        `slogan` = #{slogan},
      </if>
      `update_time` = REPLACE(unix_timestamp(current_timestamp(3)),'.','')
    </set>
    <where>
      `id` = #{id}
    </where>
  </update>

  <!-- updateLevelById -->
  <update id="updateLevelById">
		update
		`organization`
		set
		`level` = #{level},
		`update_time` = REPLACE(unix_timestamp(current_timestamp(3)),'.','')
		where
		`id` = #{id}
	</update>

  <!-- updateSortById -->
  <update id="updateSortById">
		update
		`organization`
		set
		`sort` = #{sort},
		`update_time` = REPLACE(unix_timestamp(current_timestamp(3)),'.','')
		where
		`id` = #{id}
	</update>

  <!-- updateMembersById -->
  <update id="updateMembersById">
		update
		`organization`
		set
		`members` = #{members},
		`update_time` = REPLACE(unix_timestamp(current_timestamp(3)),'.','')
		where
		`id` = #{id}
	</update>

  <!-- updateStatusById -->
  <update id="updateStatusById">
		update
		`organization`
		set
		`status` = #{status},
		`update_time` = REPLACE(unix_timestamp(current_timestamp(3)),'.','')
		where
		`id` = #{id}
	</update>


	<!-- updateProgressById -->
	<update id="updateProgressById">
		update
		`organization`
		set
		`progress` = #{progress},
		`update_time` = REPLACE(unix_timestamp(current_timestamp(3)),'.','')
		where
		`id` = #{id}
	</update>

  <!-- listByPidAndStatus -->
  <select id="listByPidAndStatus"
    resultType="pwd.initializr.account.persistence.dao.OrganizationEntity">
		select
		`id` as `id`,
		`pid` as `pid`,
		`name` as `name`,
		`logo` as `logo`,
		`description` as `description`,
		`slogan` as `slogan`,
		`level` as `level`,
		`sort` as `sort`,
		`members` as `members`,
		`status` as `status`,
		`create_time` as `createTime`,
		`update_time` as `updateTime`
		from `organization`
		where `pid` = #{pid}
		and `status` = #{status};
	</select>

</mapper>